<div class="select-program-container">
  <app-header></app-header>

  <main class="select-program-content">
    <div *ngIf="loading" class="loading-container">
      <div class="loading-spinner">
        <div class="spinner"></div>
        <p>Chargement des programmes...</p>
      </div>
    </div>

    <div *ngIf="error && !loading" class="error-container">
      <div class="error-card">
        <i class="fas fa-exclamation-triangle"></i>
        <h3>Erreur</h3>
        <p>{{ error }}</p>
        <button (click)="clearError()" class="btn-retry">
          <i class="fas fa-refresh"></i>
          Réessayer
        </button>
      </div>
    </div>

    <div *ngIf="!loading && !error" class="main-content">
      <div class="header">
        <button class="btn-back" (click)="onBack()">
          <i class="fas fa-arrow-left"></i>
          Retour
        </button>
        <div class="title-section">
          <h1>Sélectionner un Programme</h1>
          <p>Choisissez le programme d'entraînement que vous souhaitez effectuer</p>
        </div>
      </div>

      <div class="programs-container">
        <div *ngIf="userPrograms.length === 0" class="no-programs">
          <div class="empty-state">
            <i class="fas fa-dumbbell"></i>
            <h3>Aucun programme disponible</h3>
            <p>Vous n'avez pas encore de programmes d'entraînement.</p>
            <button class="btn-primary" (click)="onBack()">
              <i class="fas fa-plus"></i>
              Créer un programme
            </button>
          </div>
        </div>

        <div *ngIf="userPrograms.length > 0" class="programs-list">
          <div *ngFor="let category of getProgramsByCategory() | keyvalue" class="category-section">
            <div class="category-header">
              <h2 class="category-title">{{ category.key }}</h2>
              <span class="category-count">{{ category.value.length }} programme(s)</span>
            </div>
            
            <div class="programs-grid">
              <div 
                *ngFor="let program of category.value" 
                class="program-card"
                [class.selected]="isProgramSelected(program)"
                (click)="selectProgram(program)"
              >
                <div class="program-header">
                  <h3 class="program-name">{{ program.trainingProgram?.name || 'Programme sans nom' }}</h3>
                  <div class="program-status" [class]="(program.status || 'NOT_STARTED').toLowerCase()">
                    {{ getStatusLabel(program.status) }}
                  </div>
                </div>
                
                <div class="program-details">
                  <p class="program-description">{{ program.trainingProgram?.description || 'Aucune description' }}</p>
                  <div class="program-info">
                    <span class="info-item">
                      <i class="fas fa-calendar"></i>
                      {{ program.trainingProgram?.duration || 0 }} semaines
                    </span>
                    <span class="info-item">
                      <i class="fas fa-clock"></i>
                      {{ program.trainingProgram?.sessionsPerWeek || 0 }} sessions/semaine
                    </span>
                  </div>
                </div>
                
                <div class="program-progress" *ngIf="program.status !== 'NOT_STARTED'">
                  <div class="progress-container">
                    <div class="progress-bar">
                      <div class="progress-fill" [style.width.%]="getProgressPercentage(program)"></div>
                    </div>
                    <span class="progress-text">Semaine {{ program.currentWeek || 0 }}/{{ program.trainingProgram?.duration || 0 }}</span>
                  </div>
                </div>

                <div class="program-selection">
                  <div class="selection-indicator">
                    <i *ngIf="isProgramSelected(program)" class="fas fa-check"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="action-bar" *ngIf="!loading && !error && userPrograms.length > 0">
        <button 
          class="btn-primary btn-next"
          [disabled]="!canProceed()"
          (click)="onNext()"
        >
          <i class="fas fa-arrow-right"></i>
          Commencer l'entraînement
        </button>
      </div>
    </div>
  </main>

  <app-nav-bar [currentRoute]="'/dashboard/record'"></app-nav-bar>
</div> 